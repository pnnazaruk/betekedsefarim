<!DOCTYPE html><html lang="pl"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> Library of Yeshivas Chachmei Lublin </title>
        <link rel="icon" href="https://teatrnn.pl/files/websites/wystawy/Jesziwa/aukcje/bes.png" type="image/png">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: "Segoe UI", Roboto, Arial, sans-serif; background: #fff; color: #1a1a1a; }
        body { display: flex; flex-direction: column; }

        /* BIAŁY NAGŁÓWEK - UKŁAD ODWRÓCONY */
        #main-header {
            flex: 0 0 auto; background: #fff; color: #1a1a1a; padding: 15px 25px;
            display: flex; flex-direction: row-reverse; justify-content: space-between; align-items: center; 
            border-bottom: 2px solid #1a1a1a;
        }
        .header-title { font-family: "SBL Hebrew", serif; font-size: 24px; font-weight: bold; direction: rtl; text-align: right; }
        .header-links { display: flex; gap: 20px; font-size: 12px; text-transform: uppercase; font-weight: bold; }
        .header-links a { color: #1a1a1a; text-decoration: underline; }
        .header-links a:hover { color: #555; }

        #app-container { display: flex; flex-direction: row; flex: 1; overflow: hidden; }

        #sidebar { 
            width: 280px; flex: 0 0 auto; background: #f9f9f9; border-right: 2px solid #1a1a1a; 
            padding: 20px; box-sizing: border-box; overflow-y: auto; display: flex; flex-direction: column; gap: 25px; 
        }
        .facet-section { display: flex; flex-direction: column; gap: 10px; }
        .facet-title { font-size: 11px; font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .facet-title.heb { font-family: "SBL Hebrew", serif; text-align: right; font-size: 14px; text-transform: none; }
        
        .slider-wrapper { padding: 10px 0; }
        input[type=range] { width: 100%; accent-color: #1a1a1a; }
        #hebYearSlider { direction: rtl; } 
        .slider-val { font-size: 12px; font-weight: bold; display: flex; justify-content: space-between; margin-top: 5px; }
        
        .city-list { list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto; border: 1px solid #eee; background: #fff; }
        .city-item { font-size: 12px; padding: 5px 8px; cursor: pointer; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .city-item:hover { background: #f0f0f0; }
        .city-item.active { background: #1a1a1a; color: #fff; }
        .city-item.heb { font-family: "SBL Hebrew", serif; flex-direction: row-reverse; text-align: right; font-size: 14px; }
        .count-pill { font-size: 9px; background: #eee; padding: 2px 5px; border-radius: 10px; color: #333; }
        .active .count-pill { background: #444; color: #fff; }

        #main-content { flex: 1 1 auto; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .controls { flex: 0 0 auto; background: #fff; padding: 15px 10px; border-bottom: 2px solid #1a1a1a; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); width: 100%; box-sizing: border-box; z-index: 1000; }
        .search-wrapper { position: relative; width: 100%; }
        #search { width: 100%; padding: 15px 60px 15px 15px; border: 2px solid #1a1a1a; border-radius: 0; font-size: 17px; box-sizing: border-box; outline: none; background: #fdfdfd; }
        #inlineCounter { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 11px; font-weight: bold; color: #aaa; pointer-events: none; }
        
        .sort-wrapper { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; width: 100%; }
        .sort-container { display: flex; align-items: center; gap: 8px; font-size: 12px; font-weight: bold; text-transform: uppercase; flex: 1; min-width: 180px; }
        .sort-container.heb { flex-direction: row-reverse; font-family: "SBL Hebrew", serif; font-size: 14px; }
        select { padding: 8px; border: 1px solid #1a1a1a; border-radius: 0; background: #fff; cursor: pointer; font-size: 13px; flex-grow: 1; }

        #container { flex: 1 1 auto; overflow-y: scroll; padding: 15px 10px; width: 100%; box-sizing: border-box; background: #fff; position: relative; scroll-behavior: smooth; }
        
        .item-card { border: 1px solid #eee; margin-bottom: 15px; background: #fff; display: flex; flex-direction: column; width: 100%; box-sizing: border-box; transition: all 0.2s ease; cursor: pointer; }
        .item-card:hover { background: #fcfcfc; border-color: #1a1a1a; }
        .item-content { padding: 18px; position: relative; }
        .row-flex { display: flex; justify-content: space-between; align-items: flex-start; gap: 15px; }
        .title-pl { font-weight: bold; font-size: 17px; text-transform: uppercase; flex: 1; }
        .title-heb { font-size: 19px; color: #1a1a1a; text-align: right; dir: rtl; flex: 1; font-family: "SBL Hebrew", serif; }
        .author-row { border-top: 1px solid #eee; padding-top: 10px; margin-top: 8px; display: flex; justify-content: space-between; gap: 20px; }
        .column-pl { font-size: 15px; color: #333; flex: 1; display: flex; flex-direction: column; gap: 4px; }
        .column-he { font-size: 16px; color: #222; text-align: right; dir: rtl; flex: 1; display: flex; flex-direction: column; gap: 4px; font-family: "SBL Hebrew", serif; }

        /* MODAL */
        #modalOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 3000; }
        #modalWindow { background: #fff; width: 90%; max-width: 800px; max-height: 90%; overflow-y: auto; position: relative; border: 2px solid #1a1a1a; box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding: 30px; }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 30px; cursor: pointer; font-weight: bold; border: none; background: none; line-height: 1; }
        .modal-body { display: flex; gap: 30px; flex-wrap: wrap; }
        .modal-img-col { flex: 0 0 200px; text-align: center; }
        .modal-img-col img { width: 100%; border: 1px solid #1a1a1a; background: #fff; margin-bottom: 15px; }
        .modal-data-col { flex: 1; min-width: 300px; }
        .detail-box { border-bottom: 1px solid #eee; padding: 10px 0; }
        .label { font-size: 10px; font-weight: bold; color: #777; text-transform: uppercase; display: block; margin-bottom: 3px; }
        .value { font-size: 15px; line-height: 1.5; }
        .link-btn { display: inline-block; background: #1a1a1a; color: #fff !important; padding: 10px 20px; font-size: 12px; text-decoration: none; text-transform: uppercase; font-weight: bold; margin-top: 5px; }

        #backToTop { position: fixed; bottom: 20px; right: 20px; background: #1a1a1a; color: #fff; width: 40px; height: 40px; border: none; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 2000; font-size: 20px; }
        #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-style: italic; }
        .keyboard { display: none; grid-template-columns: repeat(9, 1fr); gap: 5px; background: #f0f0f0; padding: 10px; border: 1px solid #1a1a1a; dir: rtl; margin-bottom: 10px; }
        .key { background: #fff; border: 1px solid #1a1a1a; padding: 10px 5px; text-align: center; cursor: pointer; font-family: "SBL Hebrew", serif; font-size: 18px; }
    </style></head><body>

    <header id="main-header">
        <div class="header-title" dir="rtl">בית עקד ספרים בישיבת חכמי לובלין</div>
        <div class="header-links">
            <a href="https://teatrnn.pl/wystawy/biblioteka-jesziwy/" target="_blank">O projekcie</a>
            <a href="https://teatrnn.pl/wystawy/biblioteka-jesziwy/" target="_blank">About</a>
        </div>
    </header>

    <div id="app-container">
        <div id="sidebar">
            <div class="facet-section">
                <span class="facet-title">Rok / Year (1500-1939)</span>
                <div class="slider-wrapper">
                    <input type="range" id="yearSlider" min="1500" max="1939" value="1939" oninput="updateYearLabel(this.value); filterAndSort();">
                    <div class="slider-val"><span>1500</span><span id="yearVal">1939</span></div>
                </div>
            </div>
            <div class="facet-section">
                <span class="facet-title heb">שנה (ש"ק - ת"ש)</span>
                <div class="slider-wrapper">
                    <input type="range" id="hebYearSlider" min="5260" max="5700" value="5700" oninput="updateHebYearLabel(this.value); filterAndSort();">
                    <div class="slider-val"><span id="hebYearVal">ת"ש</span><span>ש"ק</span></div>
                </div>
            </div>
            <div class="facet-section">
                <span class="facet-title">Miasto / City</span>
                <ul id="cityListPL" class="city-list"></ul>
            </div>
            <div class="facet-section">
                <span class="facet-title heb">עיר</span>
                <ul id="cityListHE" class="city-list"></ul>
            </div>
        </div>

        <div id="main-content">
            <div class="controls">
                <div class="search-wrapper">
                    <input type="text" id="search" placeholder="SZUKAJ / SEARCH / חפש..." onkeyup="filterAndSort()">
                    <div id="inlineCounter"></div>
                </div>
                <span class="kb-toggle" onclick="toggleKeyboard()" style="font-size: 11px; font-weight: bold; text-decoration: underline; cursor: pointer; text-transform: uppercase; color: #555; margin-bottom: 5px;">Klawiatura hebrajska / מקלדת עברית</span>
                <div id="keyboard" class="keyboard">
                    <div class="key" onclick="addChar('ק')">ק</div><div class="key" onclick="addChar('ר')">ר</div><div class="key" onclick="addChar('א')">א</div>
                    <div class="key" onclick="addChar('ט')">ט</div><div class="key" onclick="addChar('ו')">ו</div><div class="key" onclick="addChar('ן')">ן</div>
                    <div class="key" onclick="addChar('ם')">ם</div><div class="key" onclick="addChar('פ')">פ</div><div class="key" onclick="delChar()">←</div>
                    <div class="key" onclick="addChar('ש')">ש</div><div class="key" onclick="addChar('ד')">ד</div><div class="key" onclick="addChar('ג')">ג</div>
                    <div class="key" onclick="addChar('כ')">כ</div><div class="key" onclick="addChar('ע')">ע</div><div class="key" onclick="addChar('י')">י</div>
                    <div class="key" onclick="addChar('ח')">ח</div><div class="key" onclick="addChar('ל')">ל</div><div class="key" onclick="addChar('ך')">ך</div>
                    <div class="key" onclick="addChar('ז')">ז</div><div class="key" onclick="addChar('ס')">ס</div><div class="key" onclick="addChar('ב')">ב</div>
                    <div class="key" onclick="addChar('ה')">ה</div><div class="key" onclick="addChar('נ')">נ</div><div class="key" onclick="addChar('מ')">מ</div>
                    <div class="key" onclick="addChar('צ')">צ</div><div class="key" onclick="addChar('ת')">ת</div><div class="key" onclick="addChar('ץ')">ץ</div>
                </div>
                <div class="sort-wrapper">
                    <div class="sort-container"><span>Sortuj wg / Sort by:</span>
                        <select id="sortSelectPL" onchange="updateSort('PL')">
                            <option value="none">Default</option><option value="title">Tytuł</option>
                            <option value="author">Autor</option><option value="year">Rok</option>
                        </select>
                    </div>
                    <div class="sort-container heb"><span>:מיין לפי</span>
                        <select id="sortSelectHE" onchange="updateSort('HE')">
                            <option value="none">סדר מקורי</option><option value="title_he">כותרת</option>
                            <option value="year_he">שנה</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="loader">Wczytywanie / Loading...</div>
            <div id="container" onscroll="handleScroll()"></div>
        </div>
    </div>

    <div id="modalOverlay" onclick="closeModal(event)">
        <div id="modalWindow">
            <button class="close-modal" onclick="document.getElementById('modalOverlay').style.display='none'">&times;</button>
            <div id="modalContent" class="modal-body"></div>
        </div>
    </div>

    <script>
        var rawRows = [];
        var colLabels = [];
        var activeFacetCity = null; 
        var sheetId = '1N--MCZSwjbLchUT37i-Ph5TwHoMxqNXUsO_zPngtokg';
        var url = 'https://docs.google.com/spreadsheets/d/' + sheetId + '/gviz/tq?tqx=out:json';

        async function init() {
            try {
                var r = await fetch(url);
                var t = await r.text();
                var json = JSON.parse(t.substring(t.indexOf("{"), t.lastIndexOf("}") + 1));
                rawRows = json.table.rows;
                colLabels = json.table.cols;
                populateFacets();
                render(rawRows);
                document.getElementById('loader').style.display = 'none';
            } catch (e) { document.getElementById('loader').innerHTML = "Błąd / שגיאה"; }
        }

        function getVal(cell) { return cell && (cell.f || (cell.v !== null ? String(cell.v) : "")) || ""; }
        function isUnknownCity(val) { var v = val ? val.trim() : ""; return !v || v === "---" || v === "-"; }
        function updateYearLabel(val) { document.getElementById('yearVal').innerText = val; }
        function updateHebYearLabel(val) { 
            var label = document.getElementById('hebYearVal');
            if(label) label.innerText = numberToHebrewYear(val); 
        }

        function populateFacets() {
            var citiesPL = {}, citiesHE = {}, unknownCount = 0;
            rawRows.forEach(r => {
                var cPL = getVal(r.c[7]);
                if (isUnknownCity(cPL)) unknownCount++;
                else { 
                    citiesPL[cPL.trim()] = (citiesPL[cPL.trim()] || 0) + 1; 
                    var cHE = getVal(r.c[22]) || cPL;
                    citiesHE[cHE.trim()] = (citiesHE[cHE.trim()] || 0) + 1;
                }
            });
            var listPL = document.getElementById('cityListPL');
            listPL.innerHTML = '<li class="city-item active" onclick="filterCity(null, event)">All</li>';
            Object.keys(citiesPL).sort((a,b)=>a.localeCompare(b,'pl')).forEach(function(city) {
                var li = document.createElement('li');
                li.className = 'city-item';
                li.onclick = function(e) { filterCity(city, e); };
                li.innerHTML = `<span>${city}</span><span class="count-pill">${citiesPL[city]}</span>`;
                listPL.appendChild(li);
            });
            if (unknownCount > 0) {
                var liU = document.createElement('li');
                liU.className = 'city-item';
                liU.onclick = function(e) { filterCity("_UNKNOWN_ID_", e); };
                liU.innerHTML = `<span>Nieznane / Unknown</span><span class="count-pill">${unknownCount}</span>`;
                listPL.appendChild(liU);
            }

            var listHE = document.getElementById('cityListHE');
            listHE.innerHTML = '<li class="city-item heb active" onclick="filterCity(null, event)">הכל</li>';
            Object.keys(citiesHE).sort((a,b)=>a.localeCompare(b,'he')).forEach(function(city) {
                var li = document.createElement('li');
                li.className = 'city-item heb';
                li.onclick = function(e) { filterCity(city, e); };
                li.innerHTML = `<span>${city}</span><span class="count-pill">${citiesHE[city]}</span>`;
                listHE.appendChild(li);
            });
            if (unknownCount > 0) {
                var liHU = document.createElement('li');
                liHU.className = 'city-item heb';
                liHU.onclick = function(e) { filterCity("_UNKNOWN_ID_", e); };
                liHU.innerHTML = `<span>לא ידוע</span><span class="count-pill">${unknownCount}</span>`;
                listHE.appendChild(liHU);
            }
        }

        function filterCity(city, event) {
            activeFacetCity = city;
            document.querySelectorAll('.city-item').forEach(el => el.classList.remove('active'));
            if (city === null) {
                document.querySelectorAll('.city-item:first-child').forEach(el => el.classList.add('active'));
            } else if (event) {
                event.currentTarget.classList.add('active');
            }
            filterAndSort();
        }

        function filterAndSort() {
            var term = document.getElementById('search').value.toLowerCase().trim();
            var maxYear = parseInt(document.getElementById('yearSlider').value);
            var maxHebYear = parseInt(document.getElementById('hebYearSlider').value);
            var sPL = document.getElementById('sortSelectPL').value;
            var sHE = document.getElementById('sortSelectHE').value;

            var filtered = rawRows.filter(function(r) { 
                if (!r || !r.c || !r.c[1]) return false;
                var cityPL = getVal(r.c[7]), cityHE = getVal(r.c[22]) || cityPL;
                var yearRaw = getVal(r.c[5]), hebYearRaw = getVal(r.c[6]);
                var matchText = r.c.some(cell => getVal(cell).toLowerCase().indexOf(term) > -1);
                var matchCity = (activeFacetCity === "_UNKNOWN_ID_") ? isUnknownCity(cityPL) : (activeFacetCity === null || cityPL.trim() === activeFacetCity.trim() || (getVal(r.c[22]) || cityPL).trim() === activeFacetCity.trim());
                if (activeFacetCity === "_UNKNOWN_ID_") return matchText && matchCity;
                if (!yearRaw || yearRaw === "---" || !hebYearRaw || hebYearRaw === "---") return false;
                var rowYear = parseInt(yearRaw.replace(/\D/g, '')) || 0;
                var rowHebYear = hebrewYearToNumber(hebYearRaw);
                return matchText && matchYear && matchHebYear && matchCity && rowYear <= maxYear && rowHebYear <= maxHebYear;
            });

            var sortVal = sPL !== "none" ? sPL : sHE;
            if(sortVal !== "none") {
               if(sortVal === 'title') filtered.sort((a,b) => getVal(a.c[1]).localeCompare(getVal(b.c[1]), 'pl'));
               if(sortVal === 'author') filtered.sort((a,b) => getVal(a.c[3]).localeCompare(getVal(b.c[3]), 'pl'));
               if(sortVal === 'place') filtered.sort((a,b) => getVal(a.c[7]).localeCompare(getVal(b.c[7]), 'pl'));
               if(sortVal === 'year') filtered.sort((a,b) => (parseInt(getVal(a.c[5]).replace(/\D/g,'')) || 0) - (parseInt(getVal(b.c[5]).replace(/\D/g,'')) || 0));
               if(sortVal === 'title_he') filtered.sort((a,b) => getVal(a.c[2]).localeCompare(getVal(b.c[2]), 'he'));
               if(sortVal === 'year_he') filtered.sort((a,b) => hebrewYearToNumber(getVal(a.c[6])) - hebrewYearToNumber(getVal(b.c[6])));
            }
            render(filtered);
        }

        function openModal(rowIndex) {
            var r = rawRows.find(row => row.c[0] && row.c[0].v == rowIndex);
            if(!r) return;
            var detailsHtml = "";
            for(var i=0; i<=22; i++) {
                if(!colLabels[i] || [8,19,20,21,22].includes(i)) continue;
                var val = getVal(r.c[i]);
                if (i === 16 && val.startsWith('http')) {
                    detailsHtml += `<div class="detail-box"><span class="label">${colLabels[i].label}</span><a href="${val}" target="_blank" class="link-btn">ZOBACZ / SEE</a></div>`;
                } else {
                    detailsHtml += `<div class="detail-box"><span class="label">${colLabels[i].label}</span><span class="value">${val || "---"}</span></div>`;
                }
            }
            var img = getVal(r.c[23]), link = getVal(r.c[16]);
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-img-col"><img src="${img}">${link ? `<a href="${link}" target="_blank" class="link-btn">ZOBACZ / SEE</a>` : ''}</div>
                <div class="modal-data-col">${detailsHtml}</div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function closeModal(e) { if(e.target.id === 'modalOverlay') e.target.style.display = 'none'; }

        function render(rows) {
            var container = document.getElementById('container');
            container.innerHTML = "";
            rows.forEach(r => {
                var card = document.createElement('div');
                card.className = 'item-card';
                card.onclick = () => openModal(r.c[0].v);
                card.innerHTML = `<div class="item-content"><div class="row-flex"><span class="title-pl">${getVal(r.c[1])}</span><span class="title-heb">${getVal(r.c[2])}</span></div><div class="author-row"><div class="column-pl"><span>${getVal(r.c[3])}</span><span style="font-size:12px;color:#888">${getVal(r.c[7])}, ${getVal(r.c[5])}</span></div><div class="column-he"><span>${getVal(r.c[4])}</span><span style="font-size:13px;color:#888">${getVal(r.c[22]) || getVal(r.c[7])}, ${getVal(r.c[6])}</span></div></div></div>`;
                container.appendChild(card);
            });
            document.getElementById('inlineCounter').innerText = rows.length;
        }

        function hebrewYearToNumber(s) { 
            if (!s || s === "---") return 999999; 
            var c = String(s).replace(/[\\\"\'\.\s\(\)\[\]]/g, "").trim(); 
            var v = {'א':1,'ב':2,'ג':3,'ד':4,'ה':5,'ו':6,'ז':7,'ח':8,'ט':9,'י':10,'כ':20,'ך':20,'ל':30,'מ':40,'ם':40,'נ':50,'ן':50,'ס':60,'ע':70,'פ':80,'ף':80,'צ':90,'ץ':90,'ק':100,'ר':200,'ש':300,'ת':400}; 
            var sum = 0; for (var i=0; i < c.length; i++) sum += v[c[i]] || 0; 
            if (sum > 0 && sum < 1000) sum += 5000; return sum; 
        }

        function numberToHebrewYear(num) {
            var n = parseInt(num); if (n > 5000) n -= 5000;
            var heb = "";
            var v = [400, 300, 200, 100, 90, 80, 70, 60, 50, 40, 30, 20, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1];
            var l = ['ת','ש','ר','ק','צ','פ','ע','ס','נ','מ','ל','כ','י','ט','ח','ז','ו','ה','ד','ג','ב','א'];
            for(var i=0; i<v.length; i++) { while(n >= v[i]) { heb += l[i]; n -= v[i]; } }
            return heb;
        }

        window.onkeydown = function(e) { if(e.key === "Escape") document.getElementById('modalOverlay').style.display = 'none'; };
        function handleScroll() { var c = document.getElementById('container'); var b = document.getElementById('backToTop'); b.style.display = c.scrollTop > 300 ? "flex" : "none"; }
        function scrollToTop() { document.getElementById('container').scrollTo({ top: 0, behavior: 'smooth' }); }
        function toggleKeyboard() { var k = document.getElementById('keyboard'); k.style.display = k.style.display === 'grid' ? 'none' : 'grid'; }
        function addChar(c) { document.getElementById('search').value += c; filterAndSort(); }
        function delChar() { var s = document.getElementById('search'); s.value = s.value.slice(0,-1); filterAndSort(); }
        function updateSort(l) { if(l === 'PL') document.getElementById('sortSelectHE').value = "none"; else document.getElementById('sortSelectPL').value = "none"; filterAndSort(); }
        init();
    </script></body></html>

